{% extends "base.html" %}

{% block title %}Batch Upload - WealthWise{% endblock %}

{% block body %}
<div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('main.dashboard') }}" class="logo">
                <span class="logo-icon">üìä</span>
                <span class="logo-text">WealthWise</span>
            </a>
        </div>

        <nav class="sidebar-nav">
            <a href="{{ url_for('main.dashboard') }}" class="nav-item">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Dashboard</span>
            </a>
            <a href="{{ url_for('portfolio.index') }}" class="nav-item active">
                <span class="nav-icon">üíº</span>
                <span class="nav-label">Portfolio</span>
            </a>
            <a href="{{ url_for('stocks.index') }}" class="nav-item">
                <span class="nav-icon">üìà</span>
                <span class="nav-label">Stocks</span>
            </a>
            <a href="{{ url_for('goals.index') }}" class="nav-item">
                <span class="nav-icon">üéØ</span>
                <span class="nav-label">Goals</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">{{ current_user.username[0].upper() }}</div>
                <div class="user-details">
                    <span class="user-name">{{ current_user.username }}</span>
                </div>
            </div>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-ghost btn-sm">Logout</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="page-header">
            <div class="page-header-content">
                <a href="{{ url_for('portfolio.index') }}" class="back-link">‚Üê Back to Portfolio</a>
                <h1>Batch Upload</h1>
                <p>Add multiple stocks at once</p>
            </div>
        </header>

        <div class="upload-grid">
            <!-- CSV Upload -->
            <div class="card">
                <div class="card-header">
                    <h3>üìÑ Upload CSV File</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('portfolio.upload_csv') }}" enctype="multipart/form-data"
                        class="upload-form">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">üì§</div>
                            <p>Drag & drop your CSV file here</p>
                            <p class="text-muted">or</p>
                            <label class="btn btn-primary btn-sm">
                                Browse Files
                                <input type="file" name="csv_file" accept=".csv" id="csvInput" hidden>
                            </label>
                            <p class="file-name" id="fileName"></p>
                        </div>

                        <div class="csv-format-info">
                            <h4>CSV Format:</h4>
                            <code>symbol,company_name,quantity,buy_price,buy_date,sector</code>
                            <p class="text-muted">Example: AAPL,Apple Inc.,10,150.00,2024-01-15,Technology</p>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block" id="uploadBtn" disabled>
                            Upload CSV
                        </button>
                    </form>
                </div>
            </div>

            <!-- Manual Batch Entry -->
            <div class="card">
                <div class="card-header">
                    <h3>‚úçÔ∏è Manual Batch Entry</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('portfolio.batch_upload') }}" class="batch-form">
                        <div class="form-group">
                            <label for="stocks_data">Enter stocks (one per line)</label>
                            <textarea id="stocks_data" name="stocks_data" rows="10" placeholder="AAPL,Apple Inc.,10,150.00,2024-01-15,Technology
MSFT,Microsoft Corp.,5,380.00,2024-01-20,Technology
GOOGL,Alphabet Inc.,3,140.00,2024-02-01,Technology"></textarea>
                        </div>

                        <div class="format-hint">
                            <p><strong>Format:</strong> symbol,company,quantity,price,date,sector</p>
                            <p class="text-muted">Or: symbol,quantity,price,date (for simpler input)</p>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            Add Stocks
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const uploadZone = document.getElementById('uploadZone');
    const csvInput = document.getElementById('csvInput');
    const fileName = document.getElementById('fileName');
    const uploadBtn = document.getElementById('uploadBtn');

    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');

        if (e.dataTransfer.files.length) {
            csvInput.files = e.dataTransfer.files;
            updateFileName();
        }
    });

    csvInput.addEventListener('change', updateFileName);

    function updateFileName() {
        if (csvInput.files.length) {
            fileName.textContent = csvInput.files[0].name;
            uploadBtn.disabled = false;
        } else {
            fileName.textContent = '';
            uploadBtn.disabled = true;
        }
    }
</script>
{% endblock %}